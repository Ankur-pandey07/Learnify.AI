{% extends "base.html" %}
{% block content %}

<style>
/* ------------------ Dashboard Cards ------------------ */
.stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 22px;
    margin-top: 25px;
}

.card {
    background: rgba(255,255,255,0.08);
    padding: 20px;
    border-radius: 14px;
    backdrop-filter: blur(14px);
    border: 1px solid rgba(255,255,255,0.12);
    box-shadow: 0 0 25px rgba(0,255,255,0.15);
    text-align: center;
    transition: .3s;
}
.card:hover {
    transform: translateY(-6px);
}

.card h2 {
    color: #00eaff;
    margin: 0;
    font-size: 2.3rem;
}

/* ------------------ Charts ------------------ */
.chart-grid {
    display: grid;
    grid-template-columns: repeat(2,1fr);
    gap: 24px;
    margin-top: 35px;
}

.chart-box {
    background: rgba(255,255,255,0.08);
    padding: 18px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.12);
    backdrop-filter: blur(14px);
}

/* ------------------ History Table ------------------ */
.table-box {
    margin-top: 35px;
    background: rgba(255,255,255,0.07);
    padding: 20px;
    border-radius: 14px;
}

table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.12);
}
th {
    background: rgba(255,255,255,0.12);
}
</style>

<h1>üëã Welcome, {{ user }}</h1>

<!-- Notifications -->
{% if notifications %}
<div class="alert" style="background:#1c2740;padding:10px;border-radius:8px;margin-bottom:15px;">
    <b>üì¢ Notifications:</b>
    <ul>
        {% for n in notifications %}
        <li>{{ n }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<!-- ======================== STAT CARDS ======================== -->
<div class="stats">

    <div class="card">
        <h2>{{ insights.top_topic }}</h2>
        <p>Most Searched Topic</p>
    </div>

    <div class="card">
        <h2>{{ insights.top_mood }}</h2>
        <p>Your Frequent Mood</p>
    </div>

    <div class="card">
        <h2>{{ insights.avg_sentiment }}</h2>
        <p>Avg Sentiment Score</p>
    </div>

</div>


<!-- ======================== CHARTS ======================== -->
<div class="chart-grid">

    <!-- TOPIC CHART -->
    <div class="chart-box">
        <h3>üîç Topic Popularity</h3>
        <canvas id="topicChart"></canvas>
    </div>

    <!-- MOOD CHART -->
    <div class="chart-box">
        <h3>üôÇ Mood Pattern</h3>
        <canvas id="moodChart"></canvas>
    </div>

    <!-- SENTIMENT LINE -->
    <div class="chart-box">
        <h3>üí¨ Sentiment Trend</h3>
        <canvas id="sentChart"></canvas>
    </div>

    <!-- RADAR -->
    <div class="chart-box">
        <h3>üéØ Mood Radar</h3>
        <canvas id="radarChart"></canvas>
    </div>

</div>


<!-- ======================== HISTORY TABLE ======================== -->
<div class="table-box">
    <h2>üìú Recent Searches</h2>

    <table>
        <thead>
            <tr>
                <th>Topic</th>
                <th>Mood</th>
                <th>Sentiment</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
            {% for h in history %}
            <tr>
                <td>{{ h.topic }}</td>
                <td>{{ h.mood }}</td>
                <td>{{ h.sentiment }}</td>
                <td>{{ h.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


<script>
/* -------- Topic Pie -------- */
new Chart(document.getElementById("topicChart"), {
    type: "pie",
    data: {
        labels: {{ topic_data.keys()|list }},
        datasets: [{
            data: {{ topic_data.values()|list }},
            backgroundColor: ["#00eaff","#0096c7","#7b2fff","#48cae4","#90e0ef"]
        }]
    }
});

/* -------- Mood Bar -------- */
new Chart(document.getElementById("moodChart"), {
    type: "bar",
    data: {
        labels: {{ mood_data.keys()|list }},
        datasets: [{
            data: {{ mood_data.values()|list }},
            backgroundColor: "#7b2fff"
        }]
    }
});

/* -------- Sentiment Line -------- */
new Chart(document.getElementById("sentChart"), {
    type: "line",
    data: {
        labels: Array.from({length: {{ sentiment_data|length }}}, (_,i)=> i+1),
        datasets: [{
            data: {{ sentiment_data|safe }},
            borderColor: "#00eaff",
            tension: .3
        }]
    }
});

/* -------- Radar -------- */
new Chart(document.getElementById("radarChart"), {
    type: "radar",
    data: {
        labels: {{ mood_data.keys()|list }},
        datasets: [{
            label: "Mood Strength",
            data: {{ mood_data.values()|list }},
            backgroundColor: "rgba(0,234,255,0.25)",
            borderColor: "#00eaff",
            borderWidth: 2
        }]
    }
});
</script>

{% endblock %}
