<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{{ topic }} Roadmap â€“ Learnify.AI</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>

<style>
:root{
  --bg1:#0b132b;
  --bg2:#1c2541;
  --panel:#0f1629;
  --panel2:#162038;
  --accent:#00b4d8;
  --accent2:#90e0ef;
  --text:#eaf7fb;
  --muted:rgba(255,255,255,0.75);
}

body{
  margin:0;padding:0;color:var(--text);
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  font-family:"Poppins",sans-serif;
}

.navbar{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 6%;background:rgba(0,0,0,0.25);backdrop-filter:blur(10px);
  position:sticky;top:0;z-index:30;
}
.brand{font-size:1.4rem;font-weight:700;color:var(--accent2);text-decoration:none;}
.navbar a{color:#fff;text-decoration:none;margin-left:14px;font-weight:500;}

.container{max-width:1180px;margin:0 auto;padding:22px 6%;}

/* HEADER */
.roadmap-header{
  background:rgba(255,255,255,0.06);padding:24px;border-radius:16px;
  box-shadow:0 12px 26px rgba(0,0,0,0.45);
}
.roadmap-title{margin:0;color:var(--accent2);}
.roadmap-sub{margin-top:6px;color:var(--muted);}

/* PROGRESS BAR */
.progress-wrapper{
  background:rgba(255,255,255,0.06);
  border-radius:12px;margin-top:20px;overflow:hidden;
}
.progress-bar{
  height:12px;background:var(--accent);width:0%;
  transition:0.4s ease;
}

/* ROADMAP LIST */
.step-card{
  background:var(--panel);
  padding:16px;border-radius:14px;margin-top:16px;
  display:flex;justify-content:space-between;align-items:center;
  border:1px solid rgba(255,255,255,0.08);
}
.step-text{font-size:1rem;font-weight:500;}
.step-btn{
  padding:8px 14px;border-radius:10px;border:none;cursor:pointer;
  background:linear-gradient(90deg,#00b4d8,#0077b6);color:white;font-weight:700;
}
.done{
  background:#1b6e86!important;color:#fff!important;border:none!important;
}

/* XP BOX */
.xp-box{
  margin-top:16px;
  padding:14px;border-radius:12px;
  background:rgba(255,255,255,0.08);
  display:flex;justify-content:space-between;align-items:center;
}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar">
  <a class="brand" href="/">Learnify.AI</a>

  <div>
    <a href="/">Home</a>
    <a href="/recommend">Recommendations</a>
    <a href="/dashboard">Dashboard</a>
  </div>
</nav>

<div class="container">

  <!-- HEADER -->
  <section class="roadmap-header">
    <h1 class="roadmap-title">{{ topic }} Roadmap</h1>
    <p class="roadmap-sub">AI-generated learning path based on your query â†’ <b>{{ query }}</b></p>

    <div style="margin-top:10px;color:var(--muted);font-size:14px;">
      Your mood: 
      {% if mood=="excited" %} ðŸ˜€ Excited  
      {% elif mood=="confused" %} ðŸ˜• Confused  
      {% else %} ðŸ™‚ Neutral  
      {% endif %}
      â€¢ Sentiment Score: {{ sentiment }}
    </div>
  </section>

  <!-- XP -->
  <div class="xp-box">
    <div style="font-size:18px;font-weight:700;color:var(--accent2);">
      XP Earned: <span id="xp">{{ progress.xp if progress else 0 }}</span>
    </div>

    <button onclick="resetProgress()" 
      style="padding:8px 14px;border-radius:8px;border:none;background:rgba(255,255,255,0.08);color:var(--accent2);font-weight:600;cursor:pointer;">
      Reset Progress
    </button>
  </div>

  <!-- PROGRESS BAR -->
  <div class="progress-wrapper">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <!-- ROADMAP STEPS -->
  <section id="steps">

    {% if ai_path %}
      {% for step in ai_path %}
      <div class="step-card" data-index="{{ loop.index0 }}">
        <div class="step-text">{{ step }}</div>

        {% if loop.index0 in progress.completed %}
          <button class="step-btn done">Completed</button>
        {% else %}
          <button class="step-btn" onclick="markStep({{ loop.index0 }})">Mark Done</button>
        {% endif %}
      </div>
      {% endfor %}
    {% else %}
      <p style="opacity:0.8;">No roadmap found.</p>
    {% endif %}

  </section>
</div>

<!-- JS -->
<script>
// PROGRESS UPDATE
function markStep(stepIndex){
    fetch("/api/progress/update",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            topic:"{{ topic }}",
            step: stepIndex,
            action:"complete_step"
        })
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.success){
            document.querySelector(`[data-index="${stepIndex}"] .step-btn`)
                .classList.add("done");
            document.querySelector(`[data-index="${stepIndex}"] .step-btn`)
                .innerText="Completed";

            document.getElementById("xp").innerText=data.new_xp;

            updateProgressBar(data.completed.length);
        }
    });
}

// RESET PROGRESS
function resetProgress(){
  fetch("/api/progress/update",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      topic:"{{ topic }}",
      step:-999,
      action:"reset"
    })
  })
  .then(()=>location.reload());
}

// INITIAL BAR LOAD
let completed = {{ progress.completed | tojson }};
updateProgressBar(completed.length);

function updateProgressBar(count){
    const total = {{ ai_path|length }};
    const percent = Math.floor((count/total)*100);
    document.getElementById("progressBar").style.width = percent+"%";
}
</script>

</body>
</html>
